#!/bin/bash
######################################################################
# A batchtools launch script template for a Torque/PBS
#
# Author: Henrik Bengtsson 
######################################################################

## Job name:
#PBS -N <%= if (exists("job.name", mode = "character")) job.name else job.hash %>

## Direct streams to logfile:
#PBS -o <%= log.file %>

## Merge standard error and output:
#PBS -j oe

## Email on abort (a) and termination (e), but not when starting (b)
#PBS -m ae

##PBS -l walltime=00:05:00

## Resources needed:
<% if (length(resources) > 0) {
  opts <- unlist(resources, use.names = TRUE)
  opts <- sprintf("%s=%s", names(opts), opts)
  opts <- paste(opts, collapse = ",") %>
#PBS -l <%= opts %>
<% } %>

module purge
module load CBC
module load r/3.6.1
module load samtools/1.3.1  ## 1.mpileup.R - critical
module load python/2.7.9    ## 2.sequenza.R

## Force single-threaded processing, e.g. data.table
export OMP_NUM_THREADS=1

## Launch R and evaluated the batchtools R job
Rscript -e 'batchtools::doJobCollection("<%= uri %>")'
